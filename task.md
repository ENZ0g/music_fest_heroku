## «Глухим Урочищам» нужен портал

К вам обратились с просьбой разработать 
сайт некоммерческого музыкального фестиваля 
«Глухие Урочища». Фестиваль проходит где-то 
в лесу в течение двух августовских дней и 
предоставляет музыкантам три сцены: «Красная»,
 «Синяя» и «Арбузик» (по фамилии одного из
  организаторов).
  
  
#### Кто пользователи?
Сайтом фестиваля будут пользоваться следующие категории 
пользователей:

1. **Потенциальные посетители фестиваля.** Им важно видеть список уже одобренных команд, сроки и информация по сценам, как добраться и тому подобное.
2. **Потенциальные исполнители.** Это музыканты и музыкальные группы, которые хотят выступить на фестивале.
3. **Кураторы**, которые определяют, принять ли музыкальную группу (и на какую сцену ее поставить) или нет.
4. **Администратор контента**, настраивающий такие вещи как: информация о наборе исполнителей, описание сцен, заполнение служебной информации.

Потенциальные посетители фестиваля пользуются сайтом без какой-либо авторизации, кураторы и потенциальные исполнители должны входить на сайт по логину/паролю, а администратор контента пользуется стандартной Django-админкой.

Дальше для краткости эти роли будем называть **Слушатель**, **Музыкант**, **Цензор** и **Админ**.

#### Роли пользователей
**Слушатели** ожидают видеть на сайте следующие страницы:

Страница описания локации концерта (картинка карты местности, как доехать, даты проведения).
Список музыкантов по сценам. Общее число заявок (без конкретизации).
Описание мероприятия (организаторы, музыкальные сцены, и тому подобное).
На подобных сайтах часто есть лента новостей, но мы можем её не делать.

***

**Музыканты** — это пользователи, которые зарегистрировались на сайте и подали заявку на участие в фестивале. Им доступны следующие разделы:

1. Страница регистрации аккаунта
2. Страница подачи заявки
3. Страница состояния поданной заявки


Для простоты решим, что заявку можно подать только одну на аккаунт, и что заявка содержит следующие поля:

1. формат выступления (исполнитель один или это музыкальная группа)
2. название (как представлять исполнителя)
3. сопроводительный текст
4. желаемая сцена (выбор из доступных сцен)
5. желаемый день выступления (текстовое поле или выбор)


После подачи заявки музыкантам на странице профиля на сайте доступна информация о состоянии заявки: «на рассмотрении», «отказано», «принято». После того, как заявка принята, музыканты видят сцену и временной слот, куда их определили. Подробнее про слоты ниже.

***

**Цензор** рассматривает непринятые заявки и голосует за принятие или отказ.

Если голосов за заявку собрано достаточно, заявку можно принять в программу и назначить ей сцену и временной слот. Цензору необходимо иметь возможность просматривать заявки и сверяться с тем, куда (на какую сцену) ещё можно поставить музыкантов, а куда ещё нет.

Функциональность, доступная цензорам:

1. Страница со списком всех заявок, с отдельными списками уже принятых и тех, что надо рассмотреть.
2. Страница описания заявки с кнопками Голосую принять, Голосую отказать, Воздерживаюсь.
3. Для музыкантов с достаточным числом проголосовавших доступны кнопки Отказать в участии и Принять в программу. Подробнее ниже.
4. Описание текущих сцен и оставщихся мест и слотов в них.


Итак, цензорам после входа на сайт должны быть доступны заявки музыкантов, информация о загруженности сцен фестиваля и возможность голосовать за заявки и принимать их в программу. У каждого цензора свой логин и пароль, которые выдаются администратором. Цензоры не регистрируются на сайте самостоятельно, их аккаунты им создаёт и заполняет админ.

***

**Администратор** отвечает за заполнение служебных страниц сайта, заведение аккаунтов цензорам и описание сцен. Он может это делать через django-admin, так что ему специально созданный интерфейс не нужен.

#### Голосование
Система голосования на фестивале построена следующим образом:

1. Только цензоры могут голосовать за или против заявок музыкантов.
2. Любой цензор может проголосовать за или против любой заявки. Можно также не голосовать.
3. Голоса всех цензоров эквивалентны и равны одному голосу.
4. Заявка попадает в программу фестиваля только если её подтвердили. Подтверждение — это отдельная операция, которую может сделать любой цензор при выполнении следующих условий:
    - Если хотя бы три цензора проголосовало «За» .
    - Число цензоров, проголосовавших «За», хотя бы на три штуки больше, чем число проголосовавших «Против». Голоса воздержавшихся не учитываются.
5. До того, как заявка подтверждена, цензор может изменить свой голос (в том числе на «Воздерживаюсь»).
6. Отказ заявки — это тоже отдельная операция, которая становится доступной, если «Против» проголосовали хотя бы 5 цензоров.
7. Если все цензоры проголосовали (любым способом, в том числе «Воздерживаюсь»), то доступный вердикт определяется по перевесу голосов (правило про три голоса в таком случае неактуально). В случае, если по голосованию выходит «ничья», доступна только опция отказа.


С учётом того, как считаются голоса, можно ввести условный рейтинг заявки. То есть если цензор проголосовал за заявку, это +1 голос, если против заявки — то это -1 голос. Если цензор не голосовал или проголосовал как «Воздерживаюсь», то рейтинг заявки не меняется. По сути условие принятия заявки можно переформулировать как «рейтинг заявки больше 3».

**Примеры**:

- Группа «Орк поправляет берёзу» подала заявку на фестиваль. Три цензора проголосовали «против», семь проголосовали «за». Значит, рейтинг +4 и кнопка Добавить в программу становится доступной любому цензору.
- Группа «Вариганова и ансамбль» подала заявку на фестиваль. «Против» исполнителя проголосовали 7 цензоров, «За» проголосовали двое. Кнопка Отказать в участии доступна любому цензору.
- Исполнитель «Хэнд» подал заявку на участие в фестивале. Один цензор проголосовал «За», один цензор проголосовал «Против». Остальные цензоры проголосовали за «Воздерживаюсь». Кнопка Отказать в участии доступна любому цензору.
- Группа «Президент и Стендапер» подалась на участие в фестивале. Шесть цензоров проголосовали «Против», девять цензоров проголосовали «За». В этом случае доступны обе кнопки.


Момент проверки доступности кнопки цензора для принятия решения по музыканту надо проверять не только на этапе загрузки страницы, но и на этапе отправки запроса на сервер: может оказаться так, что с последнего обновления страницы этим цензором другой уже успел проголосовать, и ситуация изменилась.

#### Сцены и слоты
Традиционно на фестивалях время начала выступлений коллективов смещается, поэтому для каждого дня проведения фестиваля будем использовать три временных слота: день, вечер, и поздний вечер.

Каждая сцена имеет фиксированное число музыкантов, вмещающихся в заданный слот. От организаторов вы узнали, что именная сцена первый день будет работать только поздним вечером (зато почти до утра), а синяя сцена начнёт собираться позже и будет разобрана во второй день первой. Таким образом вместимость сцен должна быть такой:

Первый день

| Сцена | День | Ранний вечер |	Поздний вечер |
--------|:----:|:------------:|:-------------:|
|Красная|4     |4             |3              |
|Синяя  |2	   |4             |4              |
|Арбузик|0	   |0             |6              |	


Второй день

| Сцена | День | Ранний вечер |	Поздний вечер |
--------|:----:|:------------:|:-------------:|
|Красная|3     |3             |3              |	
|Синяя  |5	   |2             |0              |	
|Арбузик|0	   |3             |3              |

Выбор слота под выступление какой-то команды фиксируется цензором после принятия решения об одобрении музыканта. Значит, цензор может выбрать только тот слот, в котором ещё есть места. Для простоты будем считать, что он это делает постфактум.